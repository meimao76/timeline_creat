<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>评标价计算器</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #3498db;
        }
        
        .panel {
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin-bottom: 20px;
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #bdc3c7;
        }
        
        .input-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        label {
            font-weight: bold;
            color: #2c3e50;
        }
        
        input[type="number"], input[type="text"] {
            padding: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="number"]:focus, input[type="text"]:focus {
            border-color: #3498db;
            outline: none;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            font-weight: bold;
            margin-top: 10px;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .company-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .company-input {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .result-section {
            margin-top: 30px;
        }
        
        .result-item {
            background: #ecf0f1;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 0 5px 5px 0;
        }
        
        .result-title {
            font-weight: bold;
            color: #2c3e50;
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .result-detail {
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        
        .score-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .score-table th {
            background-color: #3498db;
            color: white;
            padding: 12px;
            text-align: center;
        }
        
        .score-table td {
            border: 1px solid #bdc3c7;
            padding: 12px;
            text-align: center;
        }
        
        .score-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .score-table tr:hover {
            background-color: #e8f4fc;
        }
        
        .instructions {
            background-color: #e8f4fc;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            font-size: 14px;
        }
        
        .instructions h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 5px;
        }
        
        .highlight {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .success {
            color: #2ecc71;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .company-inputs {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>评标价计算器</h1>
        
        <div class="panel">
            <h2>输入评标信息</h2>
            <div class="input-section">
                <div class="input-group">
                    <label for="fullScore">价格得分满分：</label>
                    <input type="number" id="fullScore" min="0" step="0.1" value="40">
                </div>
                
                <h3>投标公司及报价</h3>
                <div class="company-inputs" id="companyInputs">
                    <div class="company-input">
                        <label for="companyA">公司A报价：</label>
                        <input type="number" id="companyA" min="0" step="0.01" placeholder="请输入报价">
                    </div>
                    <div class="company-input">
                        <label for="companyB">公司B报价：</label>
                        <input type="number" id="companyB" min="0" step="0.01" placeholder="请输入报价">
                    </div>
                    <div class="company-input">
                        <label for="companyC">公司C报价：</label>
                        <input type="number" id="companyC" min="0" step="0.01" placeholder="请输入报价">
                    </div>
                    <div class="company-input">
                        <label for="companyD">公司D报价：</label>
                        <input type="number" id="companyD" min="0" step="0.01" placeholder="请输入报价">
                    </div>
                </div>
                
                <button id="addCompanyBtn">添加更多公司</button>
                <button id="calculateBtn">计算基准价和得分</button>
            </div>
        </div>
        
        <div class="panel" id="resultPanel" style="display: none;">
            <h2>计算结果</h2>
            <div class="result-section">
                <div class="result-item">
                    <div class="result-title">基准价计算过程</div>
                    <div class="result-detail" id="calculationProcess"></div>
                </div>
                
                <div class="result-item">
                    <div class="result-title">最终基准价</div>
                    <div class="result-detail" id="benchmarkResult"></div>
                </div>
                
                <table class="score-table">
                    <thead>
                        <tr>
                            <th>公司名称</th>
                            <th>投标报价</th>
                            <th>与基准价差值</th>
                            <th>价格得分</th>
                        </tr>
                    </thead>
                    <tbody id="scoreResults">
                        <!-- 得分结果将通过JavaScript动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="instructions">
            <h3>计算规则说明：</h3>
            <ul>
                <li><span class="highlight">基准价计算</span>：
                    <ul>
                        <li>投标公司数量 ≥ 5家：去掉一个最高价和一个最低价后，计算剩余报价的算术平均数，再乘以0.98</li>
                        <li>投标公司数量 &lt; 5家：计算所有报价的算术平均数，再乘以0.98</li>
                    </ul>
                </li>
                <li><span class="highlight">得分计算</span>：
                    <ul>
                        <li>投标价 > 基准价：得分 = 价格满分 - (投标价 - 基准价) × 100 × 0.2</li>
                        <li>投标价 &lt; 基准价：得分 = 价格满分 - (基准价 - 投标价) × 100 × 0.1</li>
                    </ul>
                </li>
                <li>得分最低为0分，不会出现负分</li>
            </ul>
        </div>
    </div>

    <script>
        let companyCount = 4; // 初始公司数量
        
        document.addEventListener('DOMContentLoaded', function() {
            // 事件监听
            document.getElementById('calculateBtn').addEventListener('click', calculateScores);
            document.getElementById('addCompanyBtn').addEventListener('click', addCompanyInput);
            
            // 为初始输入框添加公司名称标签
            updateCompanyLabels();
        });
        
        // 添加更多公司输入框
        function addCompanyInput() {
            companyCount++;
            const companyInputs = document.getElementById('companyInputs');
            
            const newInput = document.createElement('div');
            newInput.className = 'company-input';
            newInput.innerHTML = `
                <label for="company${String.fromCharCode(64 + companyCount)}">公司${String.fromCharCode(64 + companyCount)}报价：</label>
                <input type="number" id="company${String.fromCharCode(64 + companyCount)}" min="0" step="0.01" placeholder="请输入报价">
            `;
            
            companyInputs.appendChild(newInput);
        }
        
        // 更新公司名称标签
        function updateCompanyLabels() {
            const labels = document.querySelectorAll('.company-input label');
            labels.forEach((label, index) => {
                const companyLetter = String.fromCharCode(65 + index);
                label.textContent = `公司${companyLetter}报价：`;
                label.htmlFor = `company${companyLetter}`;
            });
            
            const inputs = document.querySelectorAll('.company-input input');
            inputs.forEach((input, index) => {
                const companyLetter = String.fromCharCode(65 + index);
                input.id = `company${companyLetter}`;
            });
        }
        
        // 计算基准价和得分
        function calculateScores() {
            // 获取价格满分
            const fullScore = parseFloat(document.getElementById('fullScore').value);
            if (isNaN(fullScore) || fullScore <= 0) {
                alert('请输入有效的价格得分满分');
                return;
            }
            
            // 获取所有公司报价
            const bids = [];
            for (let i = 0; i < companyCount; i++) {
                const companyLetter = String.fromCharCode(65 + i);
                const priceInput = document.getElementById(`company${companyLetter}`);
                const price = parseFloat(priceInput.value);
                
                if (!isNaN(price) && price > 0) {
                    bids.push({
                        company: `公司${companyLetter}`,
                        price: price
                    });
                }
            }
            
            // 检查是否有有效报价
            if (bids.length === 0) {
                alert('请至少输入一个有效的投标报价');
                return;
            }
            
            // 计算基准价
            const benchmark = calculateBenchmark(bids);
            
            // 计算各公司得分
            const scores = calculateCompanyScores(bids, benchmark, fullScore);
            
            // 显示结果
            displayResults(bids, benchmark, scores, fullScore);
            
            // 显示结果面板
            document.getElementById('resultPanel').style.display = 'block';
        }
        
        // 计算基准价
        function calculateBenchmark(bids) {
            // 按价格排序
            const sortedBids = [...bids].sort((a, b) => a.price - b.price);
            
            let calculationProcess = '';
            
            if (bids.length >= 5) {
                // 去掉一个最高价和一个最低价
                const trimmedBids = sortedBids.slice(1, -1);
                const sum = trimmedBids.reduce((acc, bid) => acc + bid.price, 0);
                const average = sum / trimmedBids.length;
                const benchmark = average * 0.98;
                
                calculationProcess = `
                    投标公司数量 ≥ 5家，采用去掉最高价和最低价的方法计算：<br>
                    最高价：${sortedBids[sortedBids.length - 1].company} - ${sortedBids[sortedBids.length - 1].price.toFixed(2)}<br>
                    最低价：${sortedBids[0].company} - ${sortedBids[0].price.toFixed(2)}<br>
                    剩余${trimmedBids.length}家公司报价：${trimmedBids.map(bid => `${bid.company}(${bid.price.toFixed(2)})`).join(', ')}<br>
                    算术平均数 = ${sum.toFixed(2)} / ${trimmedBids.length} = ${average.toFixed(2)}<br>
                    基准价 = ${average.toFixed(2)} × 0.98 = <span class="highlight">${benchmark.toFixed(2)}</span>
                `;
                
                document.getElementById('calculationProcess').innerHTML = calculationProcess;
                return benchmark;
            } else {
                // 计算所有报价的算术平均数
                const sum = sortedBids.reduce((acc, bid) => acc + bid.price, 0);
                const average = sum / sortedBids.length;
                const benchmark = average * 0.98;
                
                calculationProcess = `
                    投标公司数量 < 5家，采用所有报价计算：<br>
                    所有公司报价：${sortedBids.map(bid => `${bid.company}(${bid.price.toFixed(2)})`).join(', ')}<br>
                    算术平均数 = ${sum.toFixed(2)} / ${sortedBids.length} = ${average.toFixed(2)}<br>
                    基准价 = ${average.toFixed(2)} × 0.98 = <span class="highlight">${benchmark.toFixed(2)}</span>
                `;
                
                document.getElementById('calculationProcess').innerHTML = calculationProcess;
                return benchmark;
            }
        }
        
        // 计算各公司得分
        function calculateCompanyScores(bids, benchmark, fullScore) {
            return bids.map(bid => {
                let score;
                let difference;
                
                if (bid.price > benchmark) {
                    // 高于基准价
                    difference = bid.price - benchmark;
                    score = fullScore - (difference * 100 * 0.2);
                } else {
                    // 低于基准价
                    difference = benchmark - bid.price;
                    score = fullScore - (difference * 100 * 0.1);
                }
                
                // 得分不能为负数
                score = Math.max(0, score);
                
                return {
                    company: bid.company,
                    price: bid.price,
                    difference: difference,
                    score: score
                };
            });
        }
        
        // 显示计算结果
        function displayResults(bids, benchmark, scores, fullScore) {
            // 显示基准价
            document.getElementById('benchmarkResult').innerHTML = 
                `<span class="highlight">${benchmark.toFixed(2)}</span>`;
            
            // 显示得分表格
            const scoreResults = document.getElementById('scoreResults');
            scoreResults.innerHTML = '';
            
            scores.forEach(item => {
                const row = document.createElement('tr');
                
                // 确定差值显示格式
                let differenceText = '';
                if (item.price > benchmark) {
                    differenceText = `+${item.difference.toFixed(2)}`;
                } else if (item.price < benchmark) {
                    differenceText = `-${item.difference.toFixed(2)}`;
                } else {
                    differenceText = '0.00';
                }
                
                // 确定得分颜色
                const scoreClass = item.score === fullScore ? 'success' : '';
                
                row.innerHTML = `
                    <td>${item.company}</td>
                    <td>${item.price.toFixed(2)}</td>
                    <td>${differenceText}</td>
                    <td class="${scoreClass}">${item.score.toFixed(2)}</td>
                `;
                
                scoreResults.appendChild(row);
            });
        }
    </script>
</body>
</html>